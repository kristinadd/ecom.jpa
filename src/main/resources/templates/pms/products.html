<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: common-head('Admin Console', true)}">
</head>

<body>
    <!-- Header -->
    <div class="admin-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <a href="/ecom/admin/" class="admin-brand" style="text-decoration: none; color: inherit;">
                        <i class="bi bi-shield-check me-2"></i>
                        Admin Console
                    </a>
                </div>
                <div class="col-md-4 text-end">
                    <a href="create" class="btn btn-admin">
                        <i class="bi bi-plus-circle"></i> Add Product
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Products Table -->
        <div class="table-container">
            <!-- Table with Products -->
            <div th:if="${products.size() > 0}">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>ID</th>
                            <th>Product Name</th>
                            <th>Type</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="product : ${products}">
                            <td>
                                <div class="product-image">
                                    <img th:if="${product.img != null and product.img != ''}" 
                                         th:src="@{'/images/' + ${product.img}}" 
                                         th:alt="${product.name}"
                                         style="width: 80px; height: 80px; object-fit: cover; border-radius: 6px;">
                                </div>
                            </td>
                            <td>
                                <span th:text="${product.id}"></span>
                            </td>
                            <td>
                                <div class="fw-semibold" th:text="${product.name}">Product Name</div>
                                <!-- <small class="text-muted">ID: <span th:text="${product.id}">1</span></small> -->
                            </td>
                            <td>
                                <span class="badge bg-secondary" th:text="${product.type}">Type</span>
                            </td>
                            <td>
                                <span class="fw-semibold">$<span th:text="${product.price}">0.00</span></span>
                            </td>
                            <td th:text="${product.quantity}">0</td>
                            <td>
                                <a th:href="@{{id}(id=${product.id})}" class="action-btn btn-view" title="View">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a th:href="@{update/{id}(id=${product.id})}" class="action-btn btn-edit" title="Edit">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <button class="action-btn btn-delete" title="Delete"
                                        th:onclick="'deleteProduct(' + ${product.id} + ')'">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Empty State -->
            <div th:if="${products.size() == 0}" class="empty-state">
                <i class="bi bi-box" style="font-size: 3rem; color: #cbd5e1;"></i>
                <h3>No Products Found</h3>
                <p>Start by adding your first product to the inventory.</p>
                <a href="create" class="btn btn-admin">
                    <i class="bi bi-plus-circle me-2"></i>Add First Product
                </a>
            </div>
        </div>
    </div>

    <!-- Footer Spacing -->
    <div style="height: 3rem;"></div>

    <!-- Scripts -->
    <th:block th:replace="~{fragments/head :: common-scripts}"></th:block>
    
    <script th:inline="javascript">
        // Delete product function
        function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                // Create and submit a form to delete the product
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `delete/${id}`;
                
                // Add CSRF token for Spring Security
                const csrfToken = /*[[${_csrf.token}]]*/ '';
                const csrfHeader = /*[[${_csrf.headerName}]]*/ '';
                
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = '_csrf';
                csrfInput.value = csrfToken;
                form.appendChild(csrfInput);
                
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>
</body>
</html>
